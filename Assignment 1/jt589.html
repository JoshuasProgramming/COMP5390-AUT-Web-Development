<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--import jquery-->
    <script src="https://code.jquery.com/jquery-3.5.0.js"></script>

    <!--link to css-->
    <link rel="stylesheet" href="style.css">

    <!--Title for the page-->
    <title>Assignment 1</title>

</head>

<script>

    $(document).ready(function(
    ){
        
        //created variables and variable to store the countryData url
        /*
        * url => used to store the countryData url, which we'll be getting JSON data from
        * regionCount => used to store the count of the population
        * regionAmount => used to store the count of each country in a specific region
        * languageArray => used to store each language from a region in an array
        */
        const url = 'https://www.cs.kent.ac.uk/people/staff/yh/co539-A1/countryData.php?regions';
        let regionCount = 0;
        let regionAmount = 0;
        let languageArray = [];


        //before the user selects a region, we'll set the table and reset button the 'display:none'
        $('#data_table').css("display", "none");
        $('#reset_btn').css("display", "none");
        
        /**
        * Fetch the data from the url above and assign it to a variable called 'result'
        * loop through each entry in the (JSON) data
        * append each country from (JSON) data to the select element, as an option element
        */
        $.getJSON(url, function(result){
            $.each(result, function(key,entry){
                let country = entry;
                $('#country_select_dropdown').append($('<option>').val(country).text(country));
                console.log(country);
        })
        

        /**
        * Once the select element is pressed a few processes will happen
        * The (data) table and reset btn will appear on the page
        * a new url variable named 'regionURL' will be created...
        * regionUrl => used to store extra data from the countryData url, which we'll be getting JSON data from
        * loop through the 'regionUrl' and append to the table as so...
        * append: a) the name of the country (from specific region)
        *         b) the capital of the country (from specific region)
        *         c) the population of the country (from specific region)
        *         d) the language of the country (from specific region)
        * get the average population of each region
        * get the most popular language of each region (using the 'mostOccur' function)
        * create a reset btn for resetting the page after we've selected a region
        */

        $('#country_select_dropdown').change(function() {

            //after the user selects a region, we'll set the table and reset button the 'display:inline'
            $('#data_table').css("display", "inline");
            $('#reset_btn').css("display", "inline");
            
            //regionUrl => used to store the countryData url 
            let regionUrl = 'https://www.cs.kent.ac.uk/people/staff/yh/co539-A1/countryData.php?region=' + $('#country_select_dropdown').val();

            $.getJSON(regionUrl, function(res){
            $.each(res, function(k,e){
                console.log(e.capital);
                $('#td0').append("<tr>" + "<td>"+ "<img class='countryImage' src='"+e.flag+"'</tr>");
                $('#td1').append("<tr>" + "<td>"+e.name+ "</tr>");
                $('#td2').append("<tr>" + "<td>"+ e.capital+ "</tr>");
                $('#td3').append("<tr>" + "<td>"+ e.info.population+ "</tr>");
                $('#td4').append("<tr>" + "<td>"+ e.info.language+ "</tr>");

                regionCount = regionCount + e.info.population;
                regionAmount = regionAmount + 1;
                languageArray.push(e.info.language);
            })
            
            $('#average').append("average population (2 d.p): " + (regionCount/regionAmount).toFixed(2));
            $('#most_popular_language').append("<br>" + mostOccur(languageArray));
            $('#number_of_countries').append("<br> Total number of counties: " + regionAmount);

            //function to find the most popular language of each region
            function mostOccur(languageArray){
                let m = 0;
                let mf = 1;
                let item;
                for(let i = 0; i < languageArray.length; i++){
                    for(let j = i; j < languageArray.length; j++){
                        if(languageArray[i] == languageArray[j]){
                            m++;
                        }
                        if(mf<m){
                            mf=m;
                            item = languageArray[i];
                        }
                    }
                    m=0;
                }
                return ("most popular language by " + mf + ": " + item);  
            }
            
            //task 2(c) 
            $('#input_btn').click(function(){
                let toFind = ($('#input_info').val());
                // alert(toFind);
                
                if(($("#td1:contains(toFind)")) || ($("#td2:contains(toFind)")) || ($("#td4:contains(toFind)"))){
                    $('#td1').replaceAll("<span class='selected' id='highlight'>" + $('#td1') + "</span>");  
                    $('#td2').replaceAll("<span class='selected' id='highlight'>" + $('#td2') + "</span>"); 
                    $('#td4').replaceAll("<span class='selected' id='highlight'>" + $('#td4') + "</span>"); 
                    console.log($("#td1:contains(toFind)"));
                }

            });
            
            //resetting variables relating to the most popular language and region counter
            regionAmount = 0;
            regionCount = 0;
            languageArray = [];

            //Reset function
            $('#reset_btn').click(function(){
                $('#average').empty();
                $('#most_popular_language').empty();
                $('#td0').empty();
                $('#td1').empty();
                $('#td2').empty();
                $('#td3').empty();
                $('#td4').empty();
                $('#data_table').css("display", "none");
            });

        })

        });

        });

    });

</script>

<body>
    <div class="main-container">

        <!--container that contains an h1 and select element -->
        <div class="select-container">
            <h1>Select a region: </h1>
            <!--dropdown select element-->
            <select name="countrySelect" id="country_select_dropdown">
                <option value="selectRegion">-Select Region-</option>
            </select>
        </div>

        <!--container that contains an input and button-->
        <div class="input-container">
            <input type="text" id="input_info">
            <button id="input_btn">Search</button>
            <button id="reset_btn">Reset</button>
        </div>

        <!--container that contains two p elements for task 2(b)-->
        <div class="displayInfo-container">
            <p id="average"></p>
            <p id="most_popular_language"></p>
            <p id="number_of_countries"></p>
        </div>

        <!--html table element which contains data about a specific region-->
        <table id="data_table" class="dataTable">
            <thead>
                <tr>
                    <th>Flag</th>
                    <th>Name</th>
                    <th>capital</th>
                    <th>population</th>
                    <th>language</th>
                </tr>
            </thead>
            <tbody>
                <td id="td0"></td>
                <td id="td1"></td>
                <td id="td2"></td>
                <td id="td3"></td>
                <td id="td4"></td>
            </tbody>
        </table>
        
    </div>

</body>
</html>
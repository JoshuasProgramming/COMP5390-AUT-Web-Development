<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--import jquery-->
    <script src="https://code.jquery.com/jquery-3.5.0.js"></script>

    <!--link to css-->
    <link rel="stylesheet" href="style.css">

    <!--Title for the page-->
    <title>Assignment 1</title>

</head>

<script>

    $(document).ready(function(
    ){

        let regionCount = 0;
        let regionAmount = 0;
        let languageArray = [];
      
        $('#data_table').css("display", "none");
        $('#reset_btn').css("display", "none");
        
        //created variable to store the countryData url
        const url = 'https://www.cs.kent.ac.uk/people/staff/yh/co539-A1/countryData.php?regions';

        /**
         * 1.Fetch the url of the country data
         * 2.Send a response in json
         * 3.output the json in the console
         */

        $.getJSON(url, function(result){

        //loop through each region within country data
        $.each(result, function(key,entry){
            let country = entry;
            $('#country_select_dropdown').append($('<option>').val(country).text(country));
            console.log(country);
        })

        $('#country_select_dropdown').change(function() {

            $('#data_table').css("display", "inline");
            $('#reset_btn').css("display", "inline");
            
            let regionUrl = 'https://www.cs.kent.ac.uk/people/staff/yh/co539-A1/countryData.php?region=' + $('#country_select_dropdown').val();

            $.getJSON(regionUrl, function(res){
            $.each(res, function(k,e){
                console.log(e.capital);
                $('#td0').append("<tr>" + "<td>"+ "<img class='countryImage' src='"+e.flag+"'</tr>");
                $('#td1').append("<tr>" + "<td>"+e.name+ "</tr>");
                $('#td2').append("<tr>" + "<td>"+ e.capital+ "</tr>");
                $('#td3').append("<tr>" + "<td>"+ e.info.population+ "</tr>");
                $('#td4').append("<tr>" + "<td>"+ e.info.language+ "</tr>");

                regionCount = regionCount + e.info.population;
                regionAmount = regionAmount + 1;
                languageArray.push(e.info.language);
            })

            $('#average').append("average population (2 d.p): " + (regionCount/regionAmount).toFixed(2));
            $('#most_popular_language').append("<br>" + mostOccur(languageArray));

            //function to find the most popular language of each region
            function mostOccur(languageArray){
                let m = 0;
                let mf = 1;
                let item;
                for(let i = 0; i < languageArray.length; i++){
                    for(let j = i; j < languageArray.length; j++){
                        if(languageArray[i] == languageArray[j]){
                            m++;
                        }
                        if(mf<m){
                            mf=m;
                            item = languageArray[i];
                        }
                    }
                    m=0;
                }
                return ("most popular language by " + mf + ": " + item);
            }

            //resetting variables relating to the most popular language and region counter
            regionAmount = 0;
            regionCount = 0;
            languageArray = [];


            //Reset function
            $('#reset_btn').click(function(){
                $('#average').empty();
                $('#most_popular_language').empty();
                $('#td0').empty();
                $('#td1').empty();
                $('#td2').empty();
                $('#td3').empty();
                $('#td4').empty();
                $('#data_table').css("display", "none");
            });
        })

        });

        });
    });

</script>

<body>
    <div class="main-container">

        <!--container that contains an h1 and select element -->
        <div class="select-container">
            <h1>Select a region: </h1>
            <!--dropdown select element-->
            <select name="countrySelect" id="country_select_dropdown">
                <option value="selectRegion">-Select Region-</option>
            </select>
        </div>

        <!--container that contains an input and button-->
        <div class="input-container">
            <input type="text">
            <button id="input_btn">Search</button>
            <button id="reset_btn">Reset</button>
        </div>

        <!--container that contains two p elements for task 2(b)-->
        <div class="displayInfo-container">
            <p id="average"></p>
            <p id="most_popular_language"></p>
        </div>

        <!--html table element which contains data about a specific region-->
        <table id="data_table" class="dataTable">
            <thead>
                <tr>
                    <th>Flag</th>
                    <th>Name</th>
                    <th>capital</th>
                    <th>population</th>
                    <th>language</th>
                </tr>
            </thead>
            <tbody>
                <td id="td0"></td>
                <td id="td1"></td>
                <td id="td2"></td>
                <td id="td3"></td>
                <td id="td4"></td>
            </tbody>
        </table>
        
    </div>

</body>
</html>